@page "/CreateStudUser"
@layout LoginLayout
@using Client.Components.Forms
@using Client.Services
@using Client.Services.StudUser
@using StudHub.SharedDTO.Users
@inject IStudUserClientService StudUserClientService
<div
    class="d-flex flex-column align-items-center mx-auto m-5">

    <h1>Create Stud User</h1>

    @if (!string.IsNullOrEmpty(LastSubmitResult))
    {
        <h2 class="alert @(IsSucces ? "alert-success" : "alert-danger")">
            @LastSubmitResult
        </h2>
    }
    <UserForm StudUserUser="_studUserUser"
              OnValidSubmit="ValidFormSubmitted"
              OnInvalidSubmit="InvalidFormSubmitted"
              IsSuccess="IsSucces"/>
</div>

@code {

    CreateStudUserRequestDTO _studUserUser = new CreateStudUserRequestDTO
    {
        Username = null,
        Password = null,
        Email = null
    };

    string LastSubmitResult;
    bool IsSucces;

    async Task ValidFormSubmitted()
    {
        LastSubmitResult = "Submitting stud user...";
        IsSucces = false;
        try
        {
            await StudUserClientService.CreateStudUser(_studUserUser);

            LastSubmitResult = $"Success! Stud user created with email: {_studUserUser.Email}.";
            IsSucces = true;

            _studUserUser = new CreateStudUserRequestDTO() // reset

            {
                Username = null,
                Password = null,
                Email = null
            };
        }
        catch (Exception e)
        {
            LastSubmitResult = $"Server Error: {e.Message}";
            IsSucces = false;
        }
    }

    void InvalidFormSubmitted()
    {
        IsSucces = false;
    }

}